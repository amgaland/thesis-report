\appendix
\addcontentsline{toc}{part}{ХАВСРАЛТ}

% Хавсралтын нэр. Хавсралт гэдэг үг агуулахгүй
% \chapter{Шинжилгээ зохиомж}
% Хавсралтын агуулга

% Хавсралтын нэр. Хавсралт гэдэг үг агуулахгүй
% \chapter{Кодын хэрэгжүүлэлт}

% \lstinputlisting[language=Typescript, caption=tRPC тохиргоо,label=lst:trpc,frame=single]{src/code/trpc.ts}

% \lstinputlisting[language=yaml, caption=Docker Compose ,label=lst:docker-compose,frame=single]{src/code/docker-compose.yml}

\chapter{Back-End хэрэгжүүлэлт}

\par Өгөгдлийн санд байрлах бүхий л өгөгдлүүд рүү хандах API-ууд route-үүд
\begin{lstlisting}[language=Golang, caption=Routes, frame=single]
package routes

import (
	"github.com/amgaland/epes/epes-back/controllers"
	admin "github.com/amgaland/epes/epes-back/controllers/admin"
	api "github.com/amgaland/epes/epes-back/controllers/api"
	protected "github.com/amgaland/epes/epes-back/controllers/protected"
	"github.com/gin-gonic/gin"
)

func RegisterRoutes(router *gin.Engine) {
    router.GET("/health", controllers.HealthCheck)

    authRoutes := router.Group("/auth")
    {
        authRoutes.POST("/signin", api.SignIn)
    }

    adminRoutes := router.Group("/admin")
    {
        userRoutes := adminRoutes.Group("/users")
        {
            userRoutes.GET("/", admin.GetAllUsers)
            userRoutes.POST("/", admin.CreateUser)
            userRoutes.PUT("/:id", admin.UpdateUser)
            userRoutes.DELETE("/:id", admin.DeleteUser)
            userRoutes.GET("/check-login-id", admin.CheckLoginIDExists)
        }

        userRoleRoutes := adminRoutes.Group("/user/roles")
        {
            userRoleRoutes.GET("/", admin.GetAllUserRoles)
            userRoleRoutes.POST("/", admin.CreateUserRole)
            userRoleRoutes.PUT("/:id", admin.UpdateUserRole)
            userRoleRoutes.DELETE("/:id", admin.DeleteUserRole)
            userRoleRoutes.GET("/list", admin.UserRoleHandler)
            userRoleRoutes.PUT("/update", admin.UpdateUserRoleHandler)
        }

        roleRoutes := adminRoutes.Group("/roles")
        {
            roleRoutes.GET("/", admin.GetAllRoles)
            roleRoutes.POST("/", admin.CreateRole)
            roleRoutes.PUT("/:id", admin.UpdateRole)
            roleRoutes.DELETE("/:id", admin.DeleteRole)
        }

        rolePermissionRoutes := adminRoutes.Group("/role-permissions")
        {
            rolePermissionRoutes.GET("/", admin.GetAllRolePermissions)
            rolePermissionRoutes.POST("/", admin.CreateRolePermission)
            rolePermissionRoutes.PUT("/:id", admin.UpdateRolePermission)
            rolePermissionRoutes.DELETE("/:id", admin.DeleteRolePermission)
            rolePermissionRoutes.GET("/list", admin.RolePermissionHandler)
            rolePermissionRoutes.PUT("/update", admin.UpdateRolePermissionHandler)
        }

        actionTypeRoutes := adminRoutes.Group("/action-types")
        {
            actionTypeRoutes.GET("/", admin.GetAllActionTypes)
            actionTypeRoutes.POST("/", admin.CreateActionType)
            actionTypeRoutes.PUT("/:id", admin.UpdateActionType)
            actionTypeRoutes.DELETE("/:id", admin.DeleteActionType)
        }
    }

    protectedRoutes := router.Group("/protected")
    {
        departmentRoutes := protectedRoutes.Group("/departments")
        {
            departmentRoutes.GET("/", protected.GetAllDepartments)
            departmentRoutes.POST("/", protected.CreateDepartment)
            departmentRoutes.PUT("/:id", protected.UpdateDepartment)
            departmentRoutes.DELETE("/:id", protected.DeleteDepartment)
        }

        userDepartmentRoutes := protectedRoutes.Group("/user/departments")
        {
            userDepartmentRoutes.GET("/", protected.GetAllUserDepartments)
            userDepartmentRoutes.POST("/", protected.CreateUserDepartment)
            userDepartmentRoutes.PUT("/:id", protected.UpdateUserDepartment)
            userDepartmentRoutes.DELETE("/:id", protected.DeleteUserDepartment)
            userDepartmentRoutes.GET("/list", protected.UserDepartmentHandler)
            userDepartmentRoutes.PUT("/update", protected.UpdateUserDepartmentHandler)
        }
        taskRoutes := protectedRoutes.Group("/tasks")
        {
            taskRoutes.GET("/", protected.GetAllTasks)
            taskRoutes.POST("/", protected.CreateTask)
            taskRoutes.PUT("/:id", protected.UpdateTask)
            taskRoutes.DELETE("/:id", protected.DeleteTask)
            taskRoutes.GET("/check-task-id", protected.CheckTaskIDExists)
        }
        projectRoutes := protectedRoutes.Group("/projects")
        {
            projectRoutes.GET("/", protected.GetAllProjects)
            projectRoutes.POST("/", protected.CreateProject)
            projectRoutes.PUT("/:id", protected.UpdateProject)
            projectRoutes.DELETE("/:id", protected.DeleteProject)
            projectRoutes.GET("/tasks/:id", protected.GetAllProjectTasks)
        }

        projectMemberRoutes := projectRoutes.Group("/members")
        {
            projectMemberRoutes.GET("/project/member", protected.GetProjectMember)
            projectMemberRoutes.POST("/project/member", protected.CreateProjectMember)
            projectMemberRoutes.DELETE("/project/member/:id", protected.DeleteProjectMember)

        }

        kpiRoutes := protectedRoutes.Group("/kpi")
        {
            kpiRoutes.POST("/", protected.CreateKPI)
            kpiRoutes.POST("/employee-kpi", protected.CreateEmployeeKPI)
            kpiRoutes.POST("/employee-kpi/:id", protected.CreateEmployeeKPI)
            kpiRoutes.GET("/", protected.GetEmployeeKPIs)
            kpiRoutes.GET("/employee-kpi/:id", protected.GetEmployeeKPIByID)
            kpiRoutes.DELETE("/employee-kpi/:id", protected.DeleteEmployeeKPI)
            kpiRoutes.PUT("/employee-kpi/:id", protected.UpdateEmployeeKPI)
        }
        employeeRoutes := protectedRoutes.Group("/employees")
        {
            employeeRoutes.GET("/", protected.GetAllEmployees)
            employeeRoutes.POST("/", protected.CreateEmployee)
            employeeRoutes.PUT("/:id", protected.UpdateEmployee)
            employeeRoutes.DELETE("/:id", protected.DeleteEmployee)
            employeeRoutes.GET("/:id", protected.GetEmployeeByID)
            
        }
        feedbackRoutes := protectedRoutes.Group("/feedback")
        {
            feedbackRoutes.GET("/", protected.GetAllFeedback)
            feedbackRoutes.POST("/", protected.CreateFeedback)
            feedbackRoutes.PUT("/:id", protected.UpdateFeedback)
            feedbackRoutes.DELETE("/:id", protected.DeleteFeedback)
            feedbackRoutes.GET("/:id", protected.GetFeedbackByID)
            
        }
    }

}
\end{lstlisting}

\par Back-End моделүүд
\begin{lstlisting}[language=Golang, caption=Models, frame=single]

type Model struct {
    ID        string    `json:"id" gorm:"default:gen_random_uuid()"`
    CreatedAt time.Time `json:"created_at" gorm:"default:now()"`
    UpdatedAt time.Time `json:"updated_at" gorm:"default:now()"`
    CreatedBy *string   `json:"created_by" gorm:"references:User:ID"`
    UpdatedBy *string   `json:"updated_by" gorm:"references:User:ID"`
}
    

type User struct {
	Model   
	FirstName           string        `json:"first_name"`
	LastName            string        `json:"last_name"`
	LoginID             string        `json:"login_id" gorm:"unique"`
	EmailWork           string        `json:"email_work"`
	EmailPersonal       *string       `json:"email_personal"`
	PhoneNumberWork     *string       `json:"phone_number_work"`
	PhoneNumberPersonal *string       `json:"phone_number_personal"`
	IsActive            *bool         `json:"is_active"`
	ActiveStartDate     time.Time     `json:"active_start_date"`
	ActiveEndDate       *time.Time    `json:"active_end_date"`
	Password            string        `json:"password"`
}

type LoginUser struct {
	LoginID  string `json:"login_id"`
	Password string `json:"password"`
}

type UserWithRoles struct {
	ID                  string     `json:"id"`
	FirstName           string     `json:"first_name"`
	LastName            string     `json:"last_name"`
	EmailPersonal       string     `json:"email_personal"`
	EmailWork           string     `json:"email_work"`
	LoginID             string     `json:"login_id"`
	PhoneNumberPersonal string     `json:"phone_number_personal"`
	PhoneNumberWork     string     `json:"phone_number_work"`
	IsActive            bool       `json:"is_active"`
	Token               string     `json:"token"`
	ActiveStartDate     time.Time  `json:"active_start_date"`
	ActiveEndDate       *time.Time `json:"active_end_date,omitempty"`
	Roles               string     `json:"roles"`
}

type Role struct {
	Model
	Name string `json:"name" gorm:"unique"`
}

type Project struct {
	Model
	Name           string          `json:"name"`
	Description    string          `json:"description"`
	StartDate      time.Time       `json:"start_date"`
	EndDate        *time.Time      `json:"end_date"`
	Status         string          `json:"status"`        // e.g., "Ongoing", "Completed", "Delayed"
	OwnerID        string          `json:"owner_id"`      // Reference to User
	Owner          User            `json:"owner" gorm:"foreignKey:OwnerID;references:ID"`
	// Relationship to team members
	TeamMembers    []ProjectMember `json:"team_members" gorm:"foreignKey:ProjectID"`
}

type ProjectMember struct {
	Model
	ProjectID      string   `json:"project_id"`
	Project        Project  `json:"project" gorm:"foreignKey:ProjectID;references:ID"`
	UserID         string   `json:"user_id"`
	User           User     `json:"user" gorm:"foreignKey:UserID;references:ID"`
	RoleInProject  string   `json:"role_in_project"` // Optional: "Manager", "Developer", "QA", etc.
}

type EmployeeEvaluationReport struct {
	Model
	EmployeeID  string `json:"employee_id"`
	Employee    Employee `gorm:"foreignKey:EmployeeID"`
	Period      string `json:"period"`   // e.g., "Q1 2025"
	ReportData  string `json:"report_data"` // JSON or HTML summary
	GeneratedBy string `json:"generated_by"`
	GeneratedAt time.Time `json:"generated_at"`
}
type Task struct {
	Model
	ProjectID      string     `json:"project_id"`
	Project        Project    `json:"project" gorm:"foreignKey:ProjectID;references:ID"`
	Title          string     `json:"title"`
	Description    string     `json:"description"`
	AssignedToID   string     `json:"assigned_to_id"`
	AssignedTo     User       `json:"assigned_to" gorm:"foreignKey:AssignedToID;references:ID"`
	Status         string     `json:"status"`         // e.g., "Pending", "In Progress", "Completed"
	Deadline       *time.Time `json:"deadline"`
	CompletedAt    *time.Time `json:"completed_at"`
}

type TaskFeedback struct {
	Model
	TaskID      string `json:"task_id"`
	Task        Task   `json:"task" gorm:"foreignKey:TaskID;references:ID"`
	EvaluatorID string `json:"evaluator_id"`
	Evaluator   User   `json:"evaluator" gorm:"foreignKey:EvaluatorID;references:ID"`
	Comment     string `json:"comment"`
	Rating      int    `json:"rating"`  // 1-5 or percentage
}


\end{lstlisting}
